<!--pages/package/detail/index.wxml-->
<view class="container">
  <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
  <view class="publisher-card">
    <view class="publisher-main">
      <image class="publisher-avatar" src="{{package.publisher?.avatarUrl || '/assets/default-avatar.png'}}" mode="aspectFill" />
      <view class="publisher-info">
        <view class="publisher-header">
          <text class="publisher-name">{{package.publisher?.nickname || 'ç”¨æˆ·'}}</text>
          <view class="credit-badge {{package.publisher?.creditLevel || 'NORMAL'}}">
            {{creditInfo.badge}}
          </view>
        </view>
        <text class="publisher-stats">ä¿¡ç”¨{{creditInfo.name}} Â· å·²å¸®åŠ© {{package.publisher?.totalStats?.totalHelped || 0}}äºº</text>
      </view>
    </view>
  </view>

  <!-- é¢†å–è¿›åº¦ -->
  <view class="progress-card">
    <view class="progress-header">
      <text class="progress-title">é¢†å–è¿›åº¦</text>
      <text class="progress-count">{{package.helpCount}}/{{package.maxHelp}}</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progressPercent}}%"></view>
    </view>
    <view class="progress-footer">
      <text class="progress-hint">å·²é¢†å– {{package.helpCount}}äºº</text>
      <text class="progress-remaining">è¿˜å·® {{remaining}}äºº</text>
    </view>
  </view>

  <!-- å·²å¸®åŠ©çš„äºº -->
  <view wx:if="{{package.helpers?.length > 0}}" class="helpers-card">
    <text class="section-title">å·²å¸®åŠ©çš„äºº</text>
    <view class="helpers-list">
      <view class="helper-item" wx:for="{{package.helpers}}" wx:key="openid">
        <image class="helper-avatar" src="{{item.avatarUrl || '/assets/default-avatar.png'}}" mode="aspectFill" />
        <text class="helper-name">{{item.nickname ? maskNickname(item.nickname) : 'ç”¨æˆ·'}}</text>
      </view>
    </view>
  </view>

  <!-- ç¤¼åŒ…å†…å®¹ -->
  <view class="content-card">
    <text class="section-title">ç¤¼åŒ…å†…å®¹</text>
    <view class="content-box {{package.type === 'LINK' ? 'link-box' : 'image-box'}}">
      <block wx:if="{{package.type === 'LINK'}}">
        <view class="link-content">
          <view class="link-icon-wrapper">
            <text class="link-icon-large">ğŸ”—</text>
          </view>
          <view class="link-info">
            <text class="link-title">å…ƒå®æŠ½å¥–é“¾æ¥</text>
            <text class="link-desc">ç‚¹å‡»é¢†å–æŒ‰é’®åè·³è½¬</text>
          </view>
        </view>
        <view class="link-url-box">
          <text class="link-url">{{package.giftUrl}}</text>
        </view>
      </block>
      <block wx:if="{{package.type === 'IMAGE'}}">
        <image class="package-image" src="{{package.imageUrl}}" mode="widthFix" bindtap="previewImage" />
      </block>
    </view>
  </view>

  <!-- å¥‘çº¦ä¿¡æ¯ -->
  <view wx:if="{{package.contract?.enabled}}" class="contract-card">
    <view class="contract-icon">âœ“</view>
    <view class="contract-content">
      <text class="contract-title">äº’åŠ©å¥‘çº¦å·²å¼€å¯</text>
      <text class="contract-desc">é¢†å–åéœ€åœ¨24å°æ—¶å†…å‘å¸ƒè‡ªå·±çš„ç¤¼åŒ…ï¼ŒæˆåŠŸå±¥çº¦+2ä¿¡ç”¨åˆ†ï¼Œè¿çº¦-5ä¿¡ç”¨åˆ†</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-bar">
    <block wx:if="{{isCreator}}">
      <button class="action-btn secondary" bindtap="cancelPackage">å–æ¶ˆåˆ†äº«</button>
      <button class="action-btn primary" bindtap="sharePackage">åˆ†äº«å‡ºå»</button>
    </block>
    <block wx:else>
      <button 
        class="action-btn {{canHelp ? 'primary' : 'disabled'}}" 
        bindtap="helpPackage"
        disabled="{{!canHelp || helping}}"
        loading="{{helping}}"
      >
        {{helping ? 'é¢†å–ä¸­...' : (hasHelped ? 'å·²é¢†å–' : 'ç«‹å³é¢†å–')}}
      </button>
    </block>
  </view>
</view>