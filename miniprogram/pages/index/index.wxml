<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢å’Œç­›é€‰ -->
  <view class="header-section">
    <view class="search-bar">
      <view class="search-input">
        <text class="search-icon">ğŸ”</text>
        <input placeholder="æœç´¢ç¤¼åŒ…" bindinput="onSearchInput" />
      </view>
    </view>
    
    <!-- ç±»å‹ç­›é€‰ -->
    <view class="filter-tabs">
      <view class="tab {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
        å…¨éƒ¨
      </view>
      <view class="tab {{currentTab === 'link' ? 'active' : ''}}" bindtap="switchTab" data-tab="link">
        é“¾æ¥
      </view>
      <view class="tab {{currentTab === 'image' ? 'active' : ''}}" bindtap="switchTab" data-tab="image">
        å›¾ç‰‡
      </view>
    </view>
  </view>

  <!-- ç¤¼åŒ…åˆ—è¡¨ -->
  <view class="package-list">
    <block wx:if="{{packages.length > 0}}">
      <view class="package-card" wx:for="{{packages}}" wx:key="_id" bindtap="goToDetail" data-id="{{item._id}}">
        <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
        <view class="publisher-info">
          <view class="avatar-section">
            <image class="avatar" src="{{item.publisher.avatarUrl || '/assets/default-avatar.png'}}" mode="aspectFill" />
            <view class="credit-badge {{item.publisher.creditLevel}}">
              {{item.publisher.creditBadge}}
            </view>
          </view>
          <view class="publisher-meta">
            <text class="nickname">{{item.publisher.nickname}}</text>
            <text class="publish-time">{{item.publishTime}}</text>
          </view>
          <view class="package-type-icon">
            <text wx:if="{{item.type === 'LINK'}}">ğŸ”—</text>
            <text wx:else>ğŸ“±</text>
          </view>
        </view>

        <!-- ç¤¼åŒ…å†…å®¹ -->
        <view class="package-content">
          <view class="content-box {{item.type === 'LINK' ? 'link-box' : 'image-box'}}">
            <block wx:if="{{item.type === 'LINK'}}">
              <view class="link-indicator">
                <text class="link-icon">ğŸ”—</text>
                <text class="link-text">å…ƒå®æŠ½å¥–é“¾æ¥</text>
              </view>
            </block>
            <block wx:else>
              <view class="image-preview">
                <image src="{{item.imageUrl}}" mode="aspectFill" lazy-load />
              </view>
            </block>
          </view>
        </view>

        <!-- è¿›åº¦å’Œæ“ä½œ -->
        <view class="package-footer">
          <view class="progress-section">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progressPercent}}%"></view>
            </view>
            <view class="progress-text">
              <text>è¿˜å·® <text class="highlight">{{item.remaining}}äºº</text> é¢†æ»¡</text>
            </view>
          </view>
          
          <view class="helpers-avatar">
            <view class="avatar-stack">
              <image wx:for="{{item.recentHelpers}}" wx:key="index" class="helper-avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
              <view wx:if="{{item.helpCount > 3}}" class="more-badge">+{{item.helpCount - 3}}</view>
            </view>
          </view>

          <button class="help-btn {{item.canHelp ? '' : 'disabled'}}" 
                  catchtap="onHelpPackage" 
                  data-id="{{item._id}}"
                  disabled="{{!item.canHelp}}">
            {{item.canHelp ? 'å»é¢†å–' : 'å·²é¢†å–'}}
          </button>
        </view>

        <!-- æ›å…‰å€¼ -->
        <view class="exposure-score">
          <text class="score-icon">ğŸ‘</text>
          <text class="score-text">æ›å…‰å€¼: {{item.exposureScore}}</text>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{packages.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— ç¤¼åŒ…ï¼Œå¿«å»å‘å¸ƒå§ï¼</text>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && !loading}}" class="load-more" bindtap="loadMore">
    <text>åŠ è½½æ›´å¤š</text>
  </view>
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
  </view>
</view>

<!-- æ‚¬æµ®å‘å¸ƒæŒ‰é’® -->
<view class="fab-button" bindtap="goToPublish">
  <text class="fab-icon">+</text>
</view>